---
title: "All code"
author: "Lukas"
date: '2022-06-05'
output: html_document
---
---
title: "Project for Samu"
author: "Lukas"
date: '2022-05-24'
output: html_document
---


# Load packages

```{r}
library("tidyverse")
library("psych")
library("pheatmap")
library("ggpubr")
library("patchwork")
library("ghibli")
library("reprex")
library("ggh4x")
library("ggplot2")
lit_path <-"C:/Users/lukwolt/Documents/R/LIT/"
ot_path <-"C:/Users/lukwolt/Documents/R/OT/"

ghibli_palettes$YesterdayMedium

```

#Fig. 1 Comparison between an Orbitrap Mass analyzer and Linear Ion Trap Mass Analyzer on low-input proteomics. 
#Fig. 2 Comparison of windowing scheme
## Load data 20SPD

1 ng
```{r}
#34w
LITDIA_Normal_20SPD_34w_1 <- read.csv2(paste0(lit_path, "20220218_LIT_Normal_DIA_1ng_20SPD_whisper100_1CV_auto_34w.csv"))
#40w
LITDIA_Normal_20SPD_40w_1 <- read.csv2(paste0(lit_path, "20220509_LIT_Normal_DIA_1ng_20SPD_whisper100_1CV_38ms_40w.csv"))
#45w
LITDIA_Normal_20SPD_45w_1 <- read.csv2(paste0(lit_path, "20220218_LIT_Normal_DIA_1ng_20SPD_whisper100_1CV_auto_45w.csv"))
```

100 ng
```{r}
#34w
LITDIA_Normal_20SPD_34w_100 <- read.csv2(paste0(lit_path, "20220418_LIT_Normal_DIA_100ng_20SPD_whisper100_1CV_auto_34w.csv"))
#40w
LITDIA_Normal_20SPD_40w_100 <- read.csv2(paste0(lit_path, "20220413_LIT_Normal_DIA_100ng_20SPD_whisper100_1CV_auto_40w.csv"))
#45w
LITDIA_Normal_20SPD_45w_100 <- read.csv2(paste0(lit_path, "20220418_LIT_Normal_DIA_100ng_20SPD_whisper100_1CV_auto_45w.csv"))
```
## Load data 40SPD

1 ng
```{r}
#34w
LITDIA_Normal_34w_1 <- read.csv2(paste0(lit_path, "20220509_LIT_Normal_DIA_1ng_40SPD_whisper100_1CV_auto_34w.csv"))
#40w
LITDIA_Normal_40w_1 <- read.csv2(paste0(lit_path, "20220421_LIT_Normal_DIA_1ng_40SPD_whisper100_1CV_auto.csv"))
#45w
LITDIA_Normal_45w_1 <- read.csv2(paste0(lit_path, "20220509_LIT_Normal_DIA_1ng_40SPD_whisper100_1CV_auto_45w.csv"))
```

100 ng
```{r}
#34w
LITDIA_Normal_34w_100 <- read.csv2(paste0(lit_path, "20220509_LIT_Normal_DIA_100ng_40SPD_whisper100_1CV_auto_34w.csv"))
#40w
LITDIA_Normal_40w_100 <- read.csv2(paste0(lit_path, "20220421_LIT_Normal_DIA_100ng_40SPD_whisper100_1CV_auto.csv"))
#45w
LITDIA_Normal_45w_100 <- read.csv2(paste0(lit_path, "20220509_LIT_Normal_DIA_100ng_40SPD_whisper100_1CV_auto_45w.csv"))
```
## Remove peptides found in less than 3 replicates 20 SPD
```{r}
filter_pep <- function(x) {
  x$FG.Quantity[as.logical(x$EG.IsImputed)] <- NA
  y <- x %>% 
  group_by(R.FileName, PEP.StrippedSequence) %>% 
  summarise(mean_quantity = mean(FG.Quantity, na.rm = TRUE)) %>%  
  pivot_wider(names_from = R.FileName, 
              values_from = mean_quantity) %>%
    suppressMessages()
  z <- y %>% 
  mutate(na_nbr = rowSums(is.na(y[-1]))) %>%
  mutate(mean_quantity = rowMeans(y[2:ncol(y)], na.rm = TRUE)) %>%
  mutate(filtered = !na_nbr <= 1) %>% 
  select(-na_nbr) %>% 
  suppressMessages("`summarise()` has grouped output by 'R.FileName'. You can override using the `.groups` argument.")
  message("Highlighted ", sum(z$filtered) , " peptide(s) found in less than ", ncol(y) -2, " replicates")
  
  return(z)
}
```

1 ng
```{r}
#34w
LITDIA_Normal_20SPD_34w_1 <-  filter_pep(LITDIA_Normal_20SPD_34w_1)
LITDIA_Normal_20SPD_34w_1_filter <- LITDIA_Normal_20SPD_34w_1[LITDIA_Normal_20SPD_34w_1$filtered == FALSE, ]
#40w
LITDIA_Normal_20SPD_40w_1 <-  filter_pep(LITDIA_Normal_20SPD_40w_1)
LITDIA_Normal_20SPD_40w_1_filter <- LITDIA_Normal_20SPD_40w_1[LITDIA_Normal_20SPD_40w_1$filtered == FALSE, ]
#45w
LITDIA_Normal_20SPD_45w_1 <-  filter_pep(LITDIA_Normal_20SPD_45w_1)
LITDIA_Normal_20SPD_45w_1_filter <- LITDIA_Normal_20SPD_45w_1[LITDIA_Normal_20SPD_45w_1$filtered == FALSE, ]
```

100 ng
```{r}
#34w
LITDIA_Normal_20SPD_34w_100 <-  filter_pep(LITDIA_Normal_20SPD_34w_100)
LITDIA_Normal_20SPD_34w_100_filter <- LITDIA_Normal_20SPD_34w_100[LITDIA_Normal_20SPD_34w_100$filtered == FALSE, ]
#40w
LITDIA_Normal_20SPD_40w_100 <-  filter_pep(LITDIA_Normal_20SPD_40w_100)
LITDIA_Normal_20SPD_40w_100_filter <- LITDIA_Normal_20SPD_40w_100[LITDIA_Normal_20SPD_40w_100$filtered == FALSE, ]
#45w
LITDIA_Normal_20SPD_45w_100 <-  filter_pep(LITDIA_Normal_20SPD_45w_100)
LITDIA_Normal_20SPD_45w_100_filter <- LITDIA_Normal_20SPD_45w_100[LITDIA_Normal_20SPD_45w_100$filtered == FALSE, ]
```

## Remove peptides found in less than 3 replicates 40 SPD
```{r}
filter_pep <- function(x) {
  x$FG.Quantity[as.logical(x$EG.IsImputed)] <- NA
  y <- x %>% 
  group_by(R.FileName, PEP.StrippedSequence) %>% 
  summarise(mean_quantity = mean(FG.Quantity, na.rm = TRUE)) %>%  
  pivot_wider(names_from = R.FileName, 
              values_from = mean_quantity) %>%
    suppressMessages()
  z <- y %>% 
  mutate(na_nbr = rowSums(is.na(y[-1]))) %>%
  mutate(mean_quantity = rowMeans(y[2:ncol(y)], na.rm = TRUE)) %>%
  mutate(filtered = !na_nbr <= 1) %>% 
  select(-na_nbr) %>% 
  suppressMessages("`summarise()` has grouped output by 'R.FileName'. You can override using the `.groups` argument.")
  message("Highlighted ", sum(z$filtered), " peptide(s) found in less than ", ncol(y) -2, " replicates")
  
  return(z)
}
```

1 ng
```{r}
LITDIA_Normal_34w_1 <-  filter_pep(LITDIA_Normal_34w_1)
LITDIA_Normal_34w_1_filter <- LITDIA_Normal_34w_1[LITDIA_Normal_34w_1$filtered == FALSE, ]
LITDIA_Normal_40w_1 <-  filter_pep(LITDIA_Normal_40w_1)
LITDIA_Normal_40w_1_filter <- LITDIA_Normal_40w_1[LITDIA_Normal_40w_1$filtered == FALSE, ]
LITDIA_Normal_45w_1 <-  filter_pep(LITDIA_Normal_45w_1)
LITDIA_Normal_45w_1_filter <- LITDIA_Normal_45w_1[LITDIA_Normal_45w_1$filtered == FALSE, ]
```

100 ng
```{r}
LITDIA_Normal_34w_100 <-  filter_pep(LITDIA_Normal_34w_100)
LITDIA_Normal_34w_100_filter <- LITDIA_Normal_34w_100[LITDIA_Normal_34w_100$filtered == FALSE, ]
LITDIA_Normal_40w_100 <-  filter_pep(LITDIA_Normal_40w_100)
LITDIA_Normal_40w_100_filter <- LITDIA_Normal_40w_100[LITDIA_Normal_40w_100$filtered == FALSE, ]
LITDIA_Normal_45w_100 <-  filter_pep(LITDIA_Normal_45w_100)
LITDIA_Normal_45w_100_filter <- LITDIA_Normal_45w_100[LITDIA_Normal_45w_100$filtered == FALSE, ]
```
## id 
Detect the number of identified peptides

```{r}
id_LITDIA_Normal_20SPD_34w_1 <- id_LITDIA_Normal_20SPD_40w_1 <- id_LITDIA_Normal_20SPD_45w_1 <- 
  id_LITDIA_Normal_20SPD_34w_100 <- id_LITDIA_Normal_20SPD_40w_100 <- id_LITDIA_Normal_20SPD_45w_100 <- id_LITDIA_Normal_34w_1 <- id_LITDIA_Normal_40w_1 <- id_LITDIA_Normal_45w_1 <- 
  id_LITDIA_Normal_34w_100 <- id_LITDIA_Normal_40w_100 <- id_LITDIA_Normal_45w_100 <- rep(NA, 4)
```

20 SPD

1 ng

34w
```{r}
for(i in 2:5){
  id_LITDIA_Normal_20SPD_34w_1[i-1] <- sum(!is.na(LITDIA_Normal_20SPD_34w_1[, i]))}
```
40w
```{r}
for(i in 2:5){
  id_LITDIA_Normal_20SPD_40w_1[i-1] <- sum(!is.na(LITDIA_Normal_20SPD_40w_1[, i]))}
```
45w
```{r}
for(i in 2:5){
  id_LITDIA_Normal_20SPD_45w_1[i-1] <- sum(!is.na(LITDIA_Normal_20SPD_45w_1[, i]))}
```

100 ng

34w
```{r}
for(i in 2:5){
  id_LITDIA_Normal_20SPD_34w_100[i-1] <- sum(!is.na(LITDIA_Normal_20SPD_34w_100[, i]))}
```
40w
```{r}
for(i in 2:5){
  id_LITDIA_Normal_20SPD_40w_100[i-1] <- sum(!is.na(LITDIA_Normal_20SPD_40w_100[, i]))}
```
45w
```{r}
for(i in 2:5){
  id_LITDIA_Normal_20SPD_45w_100[i-1] <- sum(!is.na(LITDIA_Normal_20SPD_45w_100[, i]))}
```

id 40 SPD

1 ng

34w
```{r}
for(i in 2:5){
  id_LITDIA_Normal_34w_1[i-1] <- sum(!is.na(LITDIA_Normal_34w_1[, i]))}
```
40w
```{r}
for(i in 2:5){
  id_LITDIA_Normal_40w_1[i-1] <- sum(!is.na(LITDIA_Normal_40w_1[, i]))}
```
45w
```{r}
for(i in 2:5){
  id_LITDIA_Normal_45w_1[i-1] <- sum(!is.na(LITDIA_Normal_45w_1[, i]))}
```

100 ng

34w
```{r}
for(i in 2:5){
  id_LITDIA_Normal_34w_100[i-1] <- sum(!is.na(LITDIA_Normal_34w_100[, i]))}
```

40w
```{r}
for(i in 2:5){
  id_LITDIA_Normal_40w_100[i-1] <- sum(!is.na(LITDIA_Normal_40w_100[, i]))}
```

45w
```{r}
for(i in 2:5){
  id_LITDIA_Normal_45w_100[i-1] <- sum(!is.na(LITDIA_Normal_45w_100[, i]))}
```

## Join 

```{r}
id_win <- data.frame(spd = rep(c(rep("20 SPD", 24), rep("40 SPD", 24))),
                     replicate = rep(1:4, 12),
                     id = c(id_LITDIA_Normal_20SPD_34w_1, id_LITDIA_Normal_20SPD_40w_1,
                            id_LITDIA_Normal_20SPD_45w_1, id_LITDIA_Normal_20SPD_34w_100, 
                            id_LITDIA_Normal_20SPD_40w_100, id_LITDIA_Normal_20SPD_45w_100, 
                            id_LITDIA_Normal_34w_1, id_LITDIA_Normal_40w_1,
                            id_LITDIA_Normal_45w_1, id_LITDIA_Normal_34w_100, 
                            id_LITDIA_Normal_40w_100, id_LITDIA_Normal_45w_100),
                     input = rep(c(rep("1 ng", 12), rep("100 ng", 12)),2),
                     method = rep(c(rep("34 ", 4), rep("40 ", 4), rep("45 ", 4)), 4))
id_win$spd <- factor(id_win$spd, levels = unique(id_win$spd))
id_win$input <- factor(id_win$input, levels = unique(id_win$input))
id_win$method <- factor(id_win$method, levels = unique(id_win$method))

```

## Plot A

```{r}
id_win_plot <- id_win %>% 
  group_by(method, input, spd) %>% 
  summarise(mean_id = mean(id),
            sd_id = sd(id))%>%
  ggplot(aes(x = method, y = mean_id, group = input, color = input))+
  theme_bw()+
  facet_grid(~spd)+
  geom_line(size = 2.5)+
  geom_point(size = 5)+
  scale_color_manual(values = c("#EAACC6","#D35087"))+
  scale_y_continuous(limits = c(3200, 16000))+
  geom_errorbar(aes(ymin = mean_id - sd_id, 
                         ymax = mean_id + sd_id),
                    width = 0.08,
                    size = 1)+
  labs(color = "Input",
       x = "Windowing scheme",
       y = "Identified peptides",
       title = "A")+
 theme(legend.title = element_text(size = 27),
        legend.text = element_text(size = 22),
        axis.text = element_text(size = 24),
        axis.title.x = element_blank(),
        axis.title = element_text(size = 27),
        legend.key.size = unit(1.4, "cm"),
        plot.title = element_text(size = 32, face = "bold",
                                  hjust = -0.09),
        panel.grid = element_blank(),
        strip.background = element_rect(fill = "#E5E4F7"),
        strip.text = element_text(size= 27),
        axis.text.x = element_text(angle = 90, vjust = 0.3, hjust = 1))
```
## CV

```{r}
compute_CV <- function(x, y, z, w, v){
  j <- x[, 1:(ncol(x)-2)] %>%
     pivot_longer(names_to = "Sample", 
               values_to = "Quantity", 
               -PEP.StrippedSequence) %>% 
  group_by(PEP.StrippedSequence) %>% 
    summarise(mean_quantity = mean(Quantity, na.rm = TRUE),
              sd_quantity = sd(Quantity, na.rm = TRUE)) %>% 
    mutate(CV = sd_quantity/mean_quantity,
           method = y,
           input = z,
           scanning_mode = w,
           spd = v)
   return(j) 
}
```

CV 20 SPD
1 ng
```{r}
LITDIA_Normal_20SPD_34w_1_CV <- compute_CV(LITDIA_Normal_20SPD_34w_1, "34 ", "1 ng", "Normal", "20 SPD")
LITDIA_Normal_20SPD_40w_1_CV <- compute_CV(LITDIA_Normal_20SPD_40w_1, "40 ", "1 ng", "Normal", "20 SPD")
LITDIA_Normal_20SPD_45w_1_CV <- compute_CV(LITDIA_Normal_20SPD_45w_1, "45 ", "1 ng", "Normal", "20 SPD")
```

100 ng
```{r}
LITDIA_Normal_20SPD_34w_100_CV <- compute_CV(LITDIA_Normal_20SPD_34w_100, "34 ", "100 ng", "Normal", "20 SPD")
LITDIA_Normal_20SPD_40w_100_CV <- compute_CV(LITDIA_Normal_20SPD_40w_100, "40 ", "100 ng", "Normal", "20 SPD")
LITDIA_Normal_20SPD_45w_100_CV <- compute_CV(LITDIA_Normal_20SPD_45w_100, "45 ", "100 ng", "Normal", "20 SPD")
```

CV 40 SPD
1 ng
```{r}
LITDIA_Normal_34w_1_CV <- compute_CV(LITDIA_Normal_34w_1, "34 ", "1 ng", "Normal", "40 SPD")
LITDIA_Normal_40w_1_CV <- compute_CV(LITDIA_Normal_40w_1, "40 ", "1 ng", "Normal", "40 SPD")
LITDIA_Normal_45w_1_CV <- compute_CV(LITDIA_Normal_45w_1, "45 ", "1 ng", "Normal", "40 SPD")
```

100 ng
```{r}
LITDIA_Normal_34w_100_CV <- compute_CV(LITDIA_Normal_34w_100, "34 ", "100 ng", "Normal", "40 SPD")
LITDIA_Normal_40w_100_CV <- compute_CV(LITDIA_Normal_40w_100, "40 ", "100 ng", "Normal", "40 SPD")
LITDIA_Normal_45w_100_CV <- compute_CV(LITDIA_Normal_45w_100, "45 ", "100 ng", "Normal", "40 SPD")
```
## Join CV
```{r}
CV_win_joined <- 
  rbind(LITDIA_Normal_20SPD_34w_1_CV, LITDIA_Normal_20SPD_40w_1_CV, LITDIA_Normal_20SPD_45w_1_CV,
        LITDIA_Normal_20SPD_34w_100_CV, LITDIA_Normal_20SPD_40w_100_CV, 
        LITDIA_Normal_20SPD_45w_100_CV, LITDIA_Normal_34w_1_CV, 
        LITDIA_Normal_40w_1_CV,LITDIA_Normal_45w_1_CV,
        LITDIA_Normal_34w_100_CV, LITDIA_Normal_40w_100_CV, 
        LITDIA_Normal_45w_100_CV)

CV_win_joined$indiv <- paste(CV_win_joined$input,CV_win_joined$method, sep = " ")
CV_win_joined$input <- factor(CV_win_joined$input, levels = unique(CV_win_joined$input))
CV_win_joined$input %>% table
CV_win_joined$method <- factor(CV_win_joined$method, levels = unique(CV_win_joined$method))
CV_win_joined$method %>% table
CV_win_joined$spd <- factor(CV_win_joined$spd, levels = unique(CV_win_joined$spd))
CV_win_joined$spd %>% table
CV_win_joined$scanning_mode <- factor(CV_win_joined$scanning_mode, levels = unique(CV_win_joined$scanning_mode))
CV_win_joined$scanning_mode %>% table
CV_win_joined$indiv2 <- paste(CV_win_joined$spd,CV_win_joined$indiv, sep = " ")
```

## Plot B

```{r}
CV_win_joined$indiv <- paste(CV_win_joined$method, CV_win_joined$input, sep = " ")

lim <- c(boxplot.stats(log10(CV_win_joined[CV_win_joined$indiv == "34 w 1 ng",]$CV*100))$stats[c(1,5)],
        boxplot.stats(log10(CV_win_joined[CV_win_joined$indiv == "34 w 100 ng",]$CV*100))$stats[c(1,5)],
        boxplot.stats(log10(CV_win_joined[CV_win_joined$indiv == "45 w 100 ng",]$CV*100))$stats[c(1,5)],
         boxplot.stats(log10(CV_win_joined[CV_win_joined$indiv == "45 w 1 ng",]$CV*100))$stats[c(1,5)])
lim <- c(min(lim), max(lim))  

CV_win_plot <- CV_win_joined %>% 
  ggplot(aes(x = method, 
             y = CV*100, 
             fill = input))+
  geom_boxplot(outlier.shape = NA,
               color = "black",
               size = 0.9)+
  scale_fill_manual(values = rep(c("#EAACC6","#D35087"),2)) +
  scale_y_log10(breaks = c(2, 5, 20, 100),
                limits = c(0.8, 190))+
  facet_grid(~spd)+
  geom_hline(yintercept = 20,
             linetype = "dashed",
             size = 0.8)+
  labs(fill = "Input",
       x = "Number of Windows",
       y = "CV (%)",
       title = "B")+
   theme_bw() +
 theme(legend.title = element_text(size = 27),
        legend.text = element_text(size = 22),
        axis.text = element_text(size = 24),
        axis.title = element_text(size = 27),
        legend.key.size = unit(1.4, "cm"),
        plot.title = element_text(size = 32, face = "bold",
                                  hjust = -0.09),
        panel.grid = element_blank(),
        strip.background = element_rect(fill = "#E5E4F7"),
        axis.title.x = element_text(vjust = 0.2),
        strip.text = element_text(size= 27))+

coord_cartesian(ylim = 10^(lim))
CV_win_plot
```

```{r}
Fig2 <- id_win_plot/CV_win_plot
```

#Fig. 3 Optimizing a balance between Windowing Schemes and Injection Times.
#Fig. 4 Increasing injection time on DIA-LIT-methods

#Fig. 5 Comparison of Injection Time on Linear Ion Trap Mass Analyzer.

## Load data

8ms
```{r}
#Turbo_1ng_8ms
LITDIA_Turbo_1_8ms <- read.csv2(paste0(lit_path, "20220420_LIT_Turbo_DIA_1ng_40SPD_whisper100_1CV_8ms.csv"))

#Turbo_5ng_8ms
LITDIA_Turbo_5_8ms <- read.csv2(paste0(lit_path, "20220420_LIT_Turbo_DIA_5ng_40SPD_whisper100_1CV_8ms.csv"))

#Turbo_10ng_8ms
LITDIA_Turbo_10_8ms <- read.csv2(paste0(lit_path, "20220420_LIT_Turbo_DIA_10ng_40SPD_whisper100_1CV_8ms.csv"))

#Turbo_100ng_8ms
LITDIA_Turbo_100_8ms <- read.csv2(paste0(lit_path, "20220420_LIT_Turbo_DIA_100ng_40SPD_whisper100_1CV_8ms.csv"))

```

16ms
```{r}
#Turbo_1ng_16ms
LITDIA_Turbo_1_16ms <- read.csv2(paste0(lit_path, "20220502_LIT_Turbo_DIA_1ng_40SPD_whisper100_1CV_auto.csv"))

#Turbo_5ng_16ms
LITDIA_Turbo_5_16ms <- read.csv2(paste0(lit_path, "20220502_LIT_Turbo_DIA_5ng_40SPD_whisper100_1CV_auto.csv"))

#Turbo_10ng_16ms
LITDIA_Turbo_10_16ms <- read.csv2(paste0(lit_path, "20220502_LIT_Turbo_DIA_10ng_40SPD_whisper100_1CV_auto.csv"))

#Turbo_100ng_16ms
LITDIA_Turbo_100_16ms <- read.csv2(paste0(lit_path, "20220502_LIT_Turbo_DIA_100ng_40SPD_whisper100_1CV_auto.csv"))

```

23ms
23ms_turbo
```{r}
#Turbo_1ng_23ms
LITDIA_Turbo_1_23ms <- read.csv2(paste0(lit_path, "20220524_LIT_Turbo_DIA_1ng_40SPD_whisper100_1CV_23ms.csv"))

#Turbo_5ng_23ms
LITDIA_Turbo_5_23ms <- read.csv2(paste0(lit_path, "20220524_LIT_Turbo_DIA_5ng_40SPD_whisper100_1CV_23ms.csv"))

#Turbo_10ng_23ms
LITDIA_Turbo_10_23ms <- read.csv2(paste0(lit_path, "20220524_LIT_Turbo_DIA_10ng_40SPD_whisper100_1CV_23ms.csv"))

#Turbo_100ng_23ms
LITDIA_Turbo_100_23ms <- read.csv2(paste0(lit_path, "20220525_LIT_Turbo_DIA_100ng_40SPD_whisper100_1CV_23ms.csv"))

```

23ms_rapid
```{r}
#Rapid_1ng_23ms
LITDIA_Rapid_1_23ms <- read.csv2(paste0(lit_path, "20220421_LIT_Rapid_DIA_1ng_40SPD_whisper100_1CV_auto.csv"))

#Rapid_5ng_23ms
LITDIA_Rapid_5_23ms <- read.csv2(paste0(lit_path, "20220502_LIT_Rapid_DIA_5ng_40SPD_whisper100_1CV_auto.csv"))

#Rapid_10ng_23ms
LITDIA_Rapid_10_23ms <- read.csv2(paste0(lit_path, "20220502_LIT_Rapid_DIA_10ng_40SPD_whisper100_1CV_auto.csv"))

#Rapid_100ng_23ms
LITDIA_Rapid_100_23ms <- read.csv2(paste0(lit_path, "20220421_LIT_Rapid_DIA_100ng_40SPD_whisper100_1CV_auto.csv"))

```

38ms
38ms_turbo
```{r}
#Turbo_1ng_38ms
LITDIA_Turbo_1_38ms <- read.csv2(paste0(lit_path, "20220525_LIT_Turbo_DIA_1ng_40SPD_whisper100_1CV_38ms.csv"))

#Turbo_5ng_38ms
LITDIA_Turbo_5_38ms <- read.csv2(paste0(lit_path, "20220525_LIT_Turbo_DIA_5ng_40SPD_whisper100_1CV_38ms.csv"))

#Turbo_10ng_38ms
LITDIA_Turbo_10_38ms <- read.csv2(paste0(lit_path, "20220525_LIT_Turbo_DIA_10ng_40SPD_whisper100_1CV_38ms.csv"))

#Turbo_100ng_38ms
LITDIA_Turbo_100_38ms <- read.csv2(paste0(lit_path, "20220525_LIT_Turbo_DIA_100ng_40SPD_whisper100_1CV_38ms.csv"))

```

38ms_rapid
```{r}
#Rapid_1ng_38ms
LITDIA_Rapid_1_38ms <- read.csv2(paste0(lit_path, "20220525_LIT_Rapid_DIA_1ng_40SPD_whisper100_1CV_38ms.csv"))

#Rapid_5ng_38ms
LITDIA_Rapid_5_38ms <- read.csv2(paste0(lit_path, "20220525_LIT_Rapid_DIA_5ng_40SPD_whisper100_1CV_38ms_40SPD_File1.csv"))

#Rapid_10ng_38ms
LITDIA_Rapid_10_38ms <- read.csv2(paste0(lit_path, "20220525_LIT_Rapid_DIA_10ng_40SPD_whisper100_1CV_38ms.csv"))

#Rapid_100ng_38ms
LITDIA_Rapid_100_38ms <- read.csv2(paste0(lit_path, "20220525_LIT_Rapid_DIA_100ng_40SPD_whisper100_1CV_38ms.csv"))

```

38ms_normal
```{r}
#Normal_1ng_38ms
LITDIA_Normal_1_38ms <- read.csv2(paste0(lit_path, "20220421_LIT_Normal_DIA_1ng_40SPD_whisper100_1CV_auto.csv"))

#Normal_5ng_38ms
LITDIA_Normal_5_38ms <- read.csv2(paste0(lit_path, "20220502_LIT_Normal_DIA_5ng_40SPD_whisper100_1CV_auto.csv"))

#Normal_10ng_38ms
LITDIA_Normal_10_38ms <- read.csv2(paste0(lit_path, "20220502_LIT_Normal_DIA_10ng_40SPD_whisper100_1CV_auto.csv"))

#Normal_100ng_38ms
LITDIA_Normal_100_38ms <- read.csv2(paste0(lit_path, "20220421_LIT_Normal_DIA_100ng_40SPD_whisper100_1CV_auto.csv"))

```

## Clean Data

8ms clean
```{r}
LITDIA_Turbo_1_8ms <-  filter_pep(LITDIA_Turbo_1_8ms)
LITDIA_Turbo_5_8ms <-  filter_pep(LITDIA_Turbo_5_8ms)
LITDIA_Turbo_10_8ms <-  filter_pep(LITDIA_Turbo_10_8ms)
LITDIA_Turbo_100_8ms <-  filter_pep(LITDIA_Turbo_100_8ms)

```
16ms clean
```{r}
LITDIA_Turbo_1_16ms <-  filter_pep(LITDIA_Turbo_1_16ms)
LITDIA_Turbo_5_16ms <-  filter_pep(LITDIA_Turbo_5_16ms)
LITDIA_Turbo_10_16ms <-  filter_pep(LITDIA_Turbo_10_16ms)
LITDIA_Turbo_100_16ms <-  filter_pep(LITDIA_Turbo_100_16ms)

```
23ms clean
23ms turbo clean
```{r}
LITDIA_Turbo_1_23ms <-  filter_pep(LITDIA_Turbo_1_23ms)
LITDIA_Turbo_5_23ms <-  filter_pep(LITDIA_Turbo_5_23ms)
LITDIA_Turbo_10_23ms <-  filter_pep(LITDIA_Turbo_10_23ms)
LITDIA_Turbo_100_23ms <-  filter_pep(LITDIA_Turbo_100_23ms)

```

23ms rapid clean
```{r}
LITDIA_Rapid_1_23ms <-  filter_pep(LITDIA_Rapid_1_23ms)
LITDIA_Rapid_5_23ms <-  filter_pep(LITDIA_Rapid_5_23ms)
LITDIA_Rapid_10_23ms <-  filter_pep(LITDIA_Rapid_10_23ms)
LITDIA_Rapid_100_23ms <-  filter_pep(LITDIA_Rapid_100_23ms)

```

38ms clean
38ms turbo clean
```{r}
LITDIA_Turbo_1_38ms <-  filter_pep(LITDIA_Turbo_1_38ms)
LITDIA_Turbo_5_38ms <-  filter_pep(LITDIA_Turbo_5_38ms)
LITDIA_Turbo_10_38ms <-  filter_pep(LITDIA_Turbo_10_38ms)
LITDIA_Turbo_100_38ms <-  filter_pep(LITDIA_Turbo_100_38ms)

```
38ms rapid clean
```{r}
LITDIA_Rapid_1_38ms <-  filter_pep(LITDIA_Rapid_1_38ms)
LITDIA_Rapid_5_38ms <-  filter_pep(LITDIA_Rapid_5_38ms)
LITDIA_Rapid_10_38ms <-  filter_pep(LITDIA_Rapid_10_38ms)
LITDIA_Rapid_100_38ms <-  filter_pep(LITDIA_Rapid_100_38ms)

```
38ms normal clean
```{r}
LITDIA_Normal_1_38ms <-  filter_pep(LITDIA_Normal_1_38ms)
LITDIA_Normal_5_38ms <-  filter_pep(LITDIA_Normal_5_38ms)
LITDIA_Normal_10_38ms <-  filter_pep(LITDIA_Normal_10_38ms)
LITDIA_Normal_100_38ms <-  filter_pep(LITDIA_Normal_100_38ms)

```

## id
Detect the number of identified peptides

```{r}
id_LITDIA_Turbo_1_8ms <- id_LITDIA_Turbo_5_8ms <- id_LITDIA_Turbo_10_8ms <- id_LITDIA_Turbo_100_8ms <- 
id_LITDIA_Turbo_1_16ms <- id_LITDIA_Turbo_5_16ms <- id_LITDIA_Turbo_10_16ms <- id_LITDIA_Turbo_100_16ms <- 
id_LITDIA_Turbo_1_23ms <- id_LITDIA_Turbo_5_23ms <- id_LITDIA_Turbo_10_23ms <- id_LITDIA_Turbo_100_23ms <-
id_LITDIA_Rapid_1_23ms <- id_LITDIA_Rapid_5_23ms <- id_LITDIA_Rapid_10_23ms <- id_LITDIA_Rapid_100_23ms <-
id_LITDIA_Turbo_1_38ms <- id_LITDIA_Turbo_5_38ms <- id_LITDIA_Turbo_10_38ms <- id_LITDIA_Turbo_100_38ms <-
id_LITDIA_Rapid_1_38ms <- id_LITDIA_Rapid_5_38ms <- id_LITDIA_Rapid_10_38ms <- id_LITDIA_Rapid_100_38ms <-
id_LITDIA_Normal_1_38ms <- id_LITDIA_Normal_5_38ms <- id_LITDIA_Normal_10_38ms <- id_LITDIA_Normal_100_38ms <-
  rep(NA, 4)
```

8ms
1ng
```{r}
for(i in 2:5){
  id_LITDIA_Turbo_1_8ms[i-1] <- sum(!is.na(LITDIA_Turbo_1_8ms[, i]))}
```

5ng
```{r}
for(i in 2:5){
  id_LITDIA_Turbo_5_8ms[i-1] <- sum(!is.na(LITDIA_Turbo_5_8ms[, i]))}
```

10ng
```{r}
for(i in 2:5){
  id_LITDIA_Turbo_10_8ms[i-1] <- sum(!is.na(LITDIA_Turbo_10_8ms[, i]))}
```

100ng
```{r}
for(i in 2:5){
  id_LITDIA_Turbo_100_8ms[i-1] <- sum(!is.na(LITDIA_Turbo_100_8ms[, i]))}
```

16ms
1ng
```{r}
for(i in 2:5){
  id_LITDIA_Turbo_1_16ms[i-1] <- sum(!is.na(LITDIA_Turbo_1_16ms[, i]))}
```

5ng
```{r}
for(i in 2:5){
  id_LITDIA_Turbo_5_16ms[i-1] <- sum(!is.na(LITDIA_Turbo_5_16ms[, i]))}
```

10ng
```{r}
for(i in 2:5){
  id_LITDIA_Turbo_10_16ms[i-1] <- sum(!is.na(LITDIA_Turbo_10_16ms[, i]))}
```

100ng
```{r}
for(i in 2:5){
  id_LITDIA_Turbo_100_16ms[i-1] <- sum(!is.na(LITDIA_Turbo_100_16ms[, i]))}
```

23ms
23ms turbo
1ng
```{r}
for(i in 2:5){
  id_LITDIA_Turbo_1_23ms[i-1] <- sum(!is.na(LITDIA_Turbo_1_23ms[, i]))}
```

5ng
```{r}
for(i in 2:5){
  id_LITDIA_Turbo_5_23ms[i-1] <- sum(!is.na(LITDIA_Turbo_5_23ms[, i]))}
```

10ng
```{r}
for(i in 2:5){
  id_LITDIA_Turbo_10_23ms[i-1] <- sum(!is.na(LITDIA_Turbo_10_23ms[, i]))}
```

100ng
```{r}
for(i in 2:5){
  id_LITDIA_Turbo_100_23ms[i-1] <- sum(!is.na(LITDIA_Turbo_100_23ms[, i]))}
```

23ms rapid
1ng
```{r}
for(i in 2:5){
  id_LITDIA_Rapid_1_23ms[i-1] <- sum(!is.na(LITDIA_Rapid_1_23ms[, i]))}
```

5ng
```{r}
for(i in 2:5){
  id_LITDIA_Rapid_5_23ms[i-1] <- sum(!is.na(LITDIA_Rapid_5_23ms[, i]))}
```

10ng
```{r}
for(i in 2:5){
  id_LITDIA_Rapid_10_23ms[i-1] <- sum(!is.na(LITDIA_Rapid_10_23ms[, i]))}
```

100ng
```{r} 
for(i in 2:5){
  id_LITDIA_Rapid_100_23ms[i-1] <- sum(!is.na(LITDIA_Rapid_100_23ms[, i]))}
```

38ms 
38ms turbo
1ng
```{r}
for(i in 2:5){
  id_LITDIA_Turbo_1_38ms[i-1] <- sum(!is.na(LITDIA_Turbo_1_38ms[, i]))}
```

5ng
```{r}
for(i in 2:5){
  id_LITDIA_Turbo_5_38ms[i-1] <- sum(!is.na(LITDIA_Turbo_5_38ms[, i]))}
```

10ng
```{r}
for(i in 2:5){
  id_LITDIA_Turbo_10_38ms[i-1] <- sum(!is.na(LITDIA_Turbo_10_38ms[, i]))}
```

100ng
```{r}
for(i in 2:5){
  id_LITDIA_Turbo_100_38ms[i-1] <- sum(!is.na(LITDIA_Turbo_100_38ms[, i]))}
```

38ms rapid
1ng
```{r}
for(i in 2:5){
  id_LITDIA_Rapid_1_38ms[i-1] <- sum(!is.na(LITDIA_Rapid_1_38ms[, i]))}
```

5ng
```{r}
for(i in 2:5){
  id_LITDIA_Rapid_5_38ms[i-1] <- sum(!is.na(LITDIA_Rapid_5_38ms[, i]))}
```

10ng
```{r}
for(i in 2:5){
  id_LITDIA_Rapid_10_38ms[i-1] <- sum(!is.na(LITDIA_Rapid_10_38ms[, i]))}
```

100ng
```{r} 
for(i in 2:5){
  id_LITDIA_Rapid_100_38ms[i-1] <- sum(!is.na(LITDIA_Rapid_100_38ms[, i]))}
```

38ms normal
1ng
```{r}
for(i in 2:5){
  id_LITDIA_Normal_1_38ms[i-1] <- sum(!is.na(LITDIA_Normal_1_38ms[, i]))}
```

5ng
```{r}
for(i in 2:5){
  id_LITDIA_Normal_5_38ms[i-1] <- sum(!is.na(LITDIA_Normal_5_38ms[, i]))}
```

10ng
```{r}
for(i in 2:5){
  id_LITDIA_Normal_10_38ms[i-1] <- sum(!is.na(LITDIA_Normal_10_38ms[, i]))}
```

100ng
```{r} 
for(i in 2:5){
  id_LITDIA_Normal_100_38ms[i-1] <- sum(!is.na(LITDIA_Normal_100_38ms[, i]))}
```


## Join
Make a table for the plot
```{r}
id_jiri <- data.frame(scanning_mode = rep(c(rep("Turbo", 48),rep("Rapid",16),rep("Turbo", 16), rep("Rapid", 16),rep("Normal", 16))),
                     replicate = rep(1:4, 28),
                     id = c(id_LITDIA_Turbo_1_8ms, id_LITDIA_Turbo_5_8ms, id_LITDIA_Turbo_10_8ms, id_LITDIA_Turbo_100_8ms,
                            id_LITDIA_Turbo_1_16ms, id_LITDIA_Turbo_5_16ms, id_LITDIA_Turbo_10_16ms, id_LITDIA_Turbo_100_16ms, 
                            id_LITDIA_Turbo_1_23ms, id_LITDIA_Turbo_5_23ms, id_LITDIA_Turbo_10_23ms, id_LITDIA_Turbo_100_23ms,
                            id_LITDIA_Rapid_1_23ms, id_LITDIA_Rapid_5_23ms, id_LITDIA_Rapid_10_23ms, id_LITDIA_Rapid_100_23ms,
                            id_LITDIA_Turbo_1_38ms, id_LITDIA_Turbo_5_38ms, id_LITDIA_Turbo_10_38ms, id_LITDIA_Turbo_100_38ms,
                            id_LITDIA_Rapid_1_38ms, id_LITDIA_Rapid_5_38ms, id_LITDIA_Rapid_10_38ms, id_LITDIA_Rapid_100_38ms,
                            id_LITDIA_Normal_1_38ms, id_LITDIA_Normal_5_38ms, id_LITDIA_Normal_10_38ms, id_LITDIA_Normal_100_38ms),
                     input = rep(c(rep("1 ng", 4), rep("5 ng", 4), rep("10 ng", 4), rep("100 ng", 4)),7),
                     injection_time = c(rep("8 ms", 16), rep("16 ms", 16), rep("23 ms",32), rep("38 ms", 48)))

id_jiri$scanning_mode <- factor(id_jiri$scanning_mode, levels = unique(id_jiri$scanning_mode))
id_jiri$input <- factor(id_jiri$input, levels = unique(id_jiri$input))
id_jiri$injection_time <- factor(id_jiri$injection_time, levels = unique(id_jiri$injection_time))

```

# Plot A

```{r}
id_plot_comp_IT <- id_jiri[-33,] %>% 
  group_by(scanning_mode, input, injection_time) %>% 
  summarise(mean_id = mean(id),
            sd_id = sd(id))%>%
  filter(input != "10 ng") %>% 
  ggplot(aes(x = input, y = mean_id, group = injection_time, color = injection_time))+
  geom_line(size = 2.5)+
  facet_grid(~scanning_mode)+
  theme_bw() +
  geom_point(size = 5) +
  scale_color_manual(values = c("#92BBD9FF","#6FB382FF","#4D6D93FF","#3e117d"))+
  geom_errorbar(aes(ymin = mean_id - sd_id, 
                         ymax = mean_id + sd_id),
                    width = 0.08,
                    size = 1)+
  labs(color = "Injection time",
       x = "Input",
       y = "Identified peptides",
       title = "A")+
  theme(legend.title = element_text(size = 27),
        legend.text = element_text(size = 22),
        axis.text = element_text(size = 24),
        axis.title = element_blank(),
        legend.key.size = unit(1.4, "cm"),
        plot.title = element_text(size = 32, face = "bold",
                                  hjust = -0.09),
        panel.grid = element_blank(),
        strip.background = element_rect(fill = "#E5E4F7"),
        strip.text = element_text(size= 27),
        axis.text.x = element_text(angle = 90, vjust = 0.3, hjust = 1))
```

## CV

Compute CV
```{r}
compute_CV <- function(x, y, z, w){
  j <- x[, 1:(ncol(x)-2)] %>%
     pivot_longer(names_to = "Sample", 
               values_to = "Quantity", 
               -PEP.StrippedSequence) %>% 
  group_by(PEP.StrippedSequence) %>% 
    summarise(mean_quantity = mean(Quantity, na.rm = TRUE),
              sd_quantity = sd(Quantity, na.rm = TRUE)) %>% 
    mutate(CV = sd_quantity/mean_quantity,
           method = y,
           input = z,
           scanning_mode = w)
   return(j) 
}
```

8ms CV 
```{r}
LITDIA_Turbo_1_8ms_CV <- compute_CV(LITDIA_Turbo_1_8ms, "8 ms", "1 ng", "Turbo")
LITDIA_Turbo_5_8ms_CV <- compute_CV(LITDIA_Turbo_5_8ms, "8 ms", "5 ng","Turbo")
LITDIA_Turbo_10_8ms_CV <- compute_CV(LITDIA_Turbo_10_8ms, "8 ms", "10 ng","Turbo")
LITDIA_Turbo_100_8ms_CV <- compute_CV(LITDIA_Turbo_100_8ms, "8 ms", "100 ng","Turbo")

```

16ms CV 
```{r}
LITDIA_Turbo_1_16ms_CV <- compute_CV(LITDIA_Turbo_1_16ms, "16 ms", "1 ng","Turbo")
LITDIA_Turbo_5_16ms_CV <- compute_CV(LITDIA_Turbo_5_16ms, "16 ms", "5 ng","Turbo")
LITDIA_Turbo_10_16ms_CV <- compute_CV(LITDIA_Turbo_10_16ms, "16 ms", "10 ng","Turbo")
LITDIA_Turbo_100_16ms_CV <- compute_CV(LITDIA_Turbo_100_16ms, "16 ms", "100 ng","Turbo")
```

23ms CV 
23ms CV turbo
```{r}
LITDIA_Turbo_1_23ms_CV <- compute_CV(LITDIA_Turbo_1_23ms, "23 ms", "1 ng","Turbo")
LITDIA_Turbo_5_23ms_CV <- compute_CV(LITDIA_Turbo_5_23ms, "23 ms", "5 ng","Turbo")
LITDIA_Turbo_10_23ms_CV <- compute_CV(LITDIA_Turbo_10_23ms, "23 ms", "10 ng","Turbo")
LITDIA_Turbo_100_23ms_CV <- compute_CV(LITDIA_Turbo_100_23ms, "23 ms", "100 ng","Turbo")
```

23ms CV rapid
```{r}
LITDIA_Rapid_1_23ms_CV <- compute_CV(LITDIA_Rapid_1_23ms, "23 ms", "1 ng","Rapid")
LITDIA_Rapid_5_23ms_CV <- compute_CV(LITDIA_Rapid_5_23ms, "23 ms", "5 ng","Rapid")
LITDIA_Rapid_10_23ms_CV <- compute_CV(LITDIA_Rapid_10_23ms, "23 ms", "10 ng","Rapid")
LITDIA_Rapid_100_23ms_CV <- compute_CV(LITDIA_Rapid_100_23ms, "23 ms", "100 ng","Rapid")
```

38ms CV 
38ms CV turbo
```{r}
LITDIA_Turbo_1_38ms_CV <- compute_CV(LITDIA_Turbo_1_38ms, "38 ms", "1 ng","Turbo")
LITDIA_Turbo_5_38ms_CV <- compute_CV(LITDIA_Turbo_5_38ms, "38 ms", "5 ng","Turbo")
LITDIA_Turbo_10_38ms_CV <- compute_CV(LITDIA_Turbo_10_38ms, "38 ms", "10 ng","Turbo")
LITDIA_Turbo_100_38ms_CV <- compute_CV(LITDIA_Turbo_100_38ms, "38 ms", "100 ng","Turbo")
```

38ms CV rapid
```{r}
LITDIA_Rapid_1_38ms_CV <- compute_CV(LITDIA_Rapid_1_38ms, "38 ms", "1 ng","Rapid")
LITDIA_Rapid_5_38ms_CV <- compute_CV(LITDIA_Rapid_5_38ms, "38 ms", "5 ng","Rapid")
LITDIA_Rapid_10_38ms_CV <- compute_CV(LITDIA_Rapid_10_38ms, "38 ms", "10 ng","Rapid")
LITDIA_Rapid_100_38ms_CV <- compute_CV(LITDIA_Rapid_100_38ms, "38 ms", "100 ng","Rapid")
```

38ms CV normal
```{r}
LITDIA_Normal_1_38ms_CV <- compute_CV(LITDIA_Normal_1_38ms, "38 ms", "1 ng","Normal")
LITDIA_Normal_5_38ms_CV <- compute_CV(LITDIA_Normal_5_38ms, "38 ms", "5 ng","Normal")
LITDIA_Normal_10_38ms_CV <- compute_CV(LITDIA_Normal_10_38ms, "38 ms", "10 ng","Normal")
LITDIA_Normal_100_38ms_CV <- compute_CV(LITDIA_Normal_100_38ms, "38 ms", "100 ng","Normal")
```

## Join CV
Make a table for the CV-plot

```{r}
CV_table_joined <- rbind(LITDIA_Turbo_1_8ms_CV, LITDIA_Turbo_5_8ms_CV, LITDIA_Turbo_10_8ms_CV, LITDIA_Turbo_100_8ms_CV,
LITDIA_Turbo_1_16ms_CV, LITDIA_Turbo_5_16ms_CV, LITDIA_Turbo_10_16ms_CV, LITDIA_Turbo_100_16ms_CV,
LITDIA_Turbo_1_23ms_CV, LITDIA_Turbo_5_23ms_CV, LITDIA_Turbo_10_23ms_CV, LITDIA_Turbo_100_23ms_CV,
LITDIA_Rapid_1_23ms_CV, LITDIA_Rapid_5_23ms_CV, LITDIA_Rapid_10_23ms_CV, LITDIA_Rapid_100_23ms_CV,  
LITDIA_Turbo_1_38ms_CV, LITDIA_Turbo_5_38ms_CV, LITDIA_Turbo_10_38ms_CV, LITDIA_Turbo_100_38ms_CV,
LITDIA_Rapid_1_38ms_CV, LITDIA_Rapid_5_38ms_CV, LITDIA_Rapid_10_38ms_CV, LITDIA_Rapid_100_38ms_CV,  
LITDIA_Normal_1_38ms_CV, LITDIA_Normal_5_38ms_CV, LITDIA_Normal_10_38ms_CV, LITDIA_Normal_100_38ms_CV)

CV_table_joined$indiv <- paste(CV_table_joined$input,CV_table_joined$method, sep = " ")
CV_table_joined$input <- factor(CV_table_joined$input, levels = unique(CV_table_joined$input))
CV_table_joined$input %>% table
CV_table_joined$method <- factor(CV_table_joined$method, levels = unique(CV_table_joined$method))
CV_table_joined$method %>% table
CV_table_joined$scanning_mode <- factor(CV_table_joined$scanning_mode, levels = unique(CV_table_joined$scanning_mode))
CV_table_joined$scanning_mode %>% table
CV_table_joined$indiv2 <- paste(CV_table_joined$scanning_mode,CV_table_joined$indiv, sep = " ")
```


## Plot B

```{r}
lim <- c(boxplot.stats(log10(CV_table_joined[CV_table_joined$indiv2 == "Turbo 1 ng 8 ms",]$CV*100))$stats[c(1,5)],
         boxplot.stats(log10(CV_table_joined[CV_table_joined$indiv2 == "Turbo 1 ng 23 ms",]$CV*100))$stats[c(1,5)])
lim <- c(min(lim), max(lim))  

CV_table_joined$indiv <- paste(CV_table_joined$method, CV_table_joined$input, sep = " ")

CV_table_plot <- CV_table_joined %>% 
   filter(input != "10 ng") %>% ggplot(aes(x = input, 
             y = CV*100, 
             fill = method))+
  geom_boxplot(outlier.shape = NA,
               color = "black",
               size = 0.9)+
   facet_grid(~scanning_mode)+
  force_panelsizes(cols = c(2, 1,0.5))+
  scale_fill_manual(values = rep(c("#92BBD9FF","#6FB382FF","#4D6D93FF","#3e117d"),4))+ 
  scale_y_log10(breaks = c(1, 20, 100),
                limits = c(0.08, 190))+
  geom_hline(yintercept = 20,
             linetype = "dashed",
             size = 0.8)+
  labs(fill = "Injection time",
    x = "Input",
       y = "CV (%)",
       title = "B")+
 
coord_cartesian(ylim = 10^(lim))+
  theme_bw() +

 theme(legend.position = "none",
        plot.title = element_text(size = 32, face = "bold",
                                  hjust = -0.08),
        panel.grid = element_blank(),
        axis.title = element_text(size = 27),
        axis.text = element_text(size = 24),
        axis.text.x = element_text(angle = 90, vjust = 0.3, hjust = 1),
        strip.text.x = element_text(size = 27),
        strip.background = element_rect(fill = "#E5E4F7"),
         axis.title.x = element_text(vjust = -1.5))

CV_table_plot
```

# Final plot
Merge the two plots

```{r}
Fig5 <- ((id_plot_comp_IT + plot_spacer()) + plot_layout(width = c(1, 0)))/CV_table_plot

```

#Fig. 6 Improvement of the Number of Points Across Chromatographic Peaks
